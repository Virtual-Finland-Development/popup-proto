<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Embed profile data prototype</title>
</head>

<body>
  <div class="pluginTargetArea">
    <p>Targeted button from the site:</p>
    <button id="targetButton">Open profile data modal</button>
  </div>

  <div class="pluginEventsOutputArea">

  </div>
  <script type="text/javascript">
    const PluginEventsListener = {
      start() {
        this.log("Listening for plugin events..");
        window.document.addEventListener("pluginProfileData", this.handleEvent.bind(this));
      },
      stop() {
        this.log("Stopped listening for plugin events..");
        window.document.removeEventListener("pluginProfileData", this.handleEvent.bind(this));
      },
      handleEvent(event) {
        this.log("Received plugin event", event);
        if (event.type === "pluginProfileData") {
          const outputArea = document.querySelector(".pluginEventsOutputArea");
          outputArea.innerHTML = `<p>Profile data received from plugin:</p><pre>${JSON.stringify(event.detail, null, 2)}</pre>`;
        }
      },
      log(...message) {
        console.log("[PluginEventsListener]", ...message);
      }
    }

    PluginEventsListener.start();

    //POPUP_PROTO_PLUGIN_TARGET_BUTTON_ID = "targetButton"
    const targetButton = document.querySelector("#targetButton");
    targetButton.addEventListener("click", () => {
      window.document.dispatchEvent(new Event("openPopupProtoPluginModal"));
    });

  </script>
  <script type="module" src="/src/main.ts"></script>
</body>

</html>